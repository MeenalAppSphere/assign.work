<nz-spin nzTip="Loading..." [nzSpinning]="getTaskInProcess">
  <nz-card
    nzSize="small"
    [nzBordered]="false"
    [nzTitle]="titleTemplateRef"
    [nzExtra]="createSprintBtnTemplate"
    class="backlog-page">
    <ng-template #titleTemplateRef>

      <span class="p-r-30">
        <span class="p-r-15 font-size-18 text-black">Backlog/Sprint</span>
        <img src="../../../assets/images/icons/info.svg" height="16" nz-tooltip nzTooltipTitle="About Backlog page..."/>
      </span>

<!--      <span class="badge backlog-badge" *ngIf="sprintData && sprintData?.totalEstimationReadable">-->
<!--        <span class="text-red">Total Backlogs</span><span class="p-l-5 text-black">{{sprintData?.totalEstimationReadable}}</span>-->
<!--      </span>-->


    </ng-template>
    <ng-template #createSprintBtnTemplate>

    </ng-template>


    <section class="m-b-10">
      <nz-spin nzTip="Checking Unpublished Sprint..." [nzSpinning]="gettingUnpublishedInProcess">


        <div class="row clearfix m-b-10 m-t-10" *ngIf="sprintData && sprintData.id">

          <div class="col">
            <span class="font-size-14">

              <span class="font-size-18 m-r-30 text-black font-weight-normal">{{sprintData.name}}</span>

              <span class="m-r-25 text-gray-light-2 font-size-13" *ngIf="sprintData.totalEstimationReadable">
                <span>{{sprintData?.totalEstimationReadable}}</span>
                <span class="font-weight-light">  Sprint Hours </span>
              </span>

              <span class="m-r-10 text-gray-light-2 font-size-13">
                <span>{{sprintData.totalCapacityReadable}}</span>
                <span class="m-r-25 font-weight-light"> Sprint Capacity</span>
              </span>



              <span class="font-size-12 font-size-13" [ngClass]="{'text-gray-light-2': sprintData.totalRemainingCapacity>0, 'text-red': sprintData.totalRemainingCapacity<0}" *ngIf="sprintData.totalRemainingCapacityReadable">
                <span class="p-l-5">{{sprintData?.totalRemainingCapacityReadable}}</span>
                <span class="font-weight-light"> Remains</span>
              </span>
            </span>

<!--            <span class="float-right font-weight-light" >-->
<!--              <a href="javascript:void(0);" (click)="toggleAddSprint()" class="p-r-25">Edit Sprint </a>-->
<!--              <a href="javascript:void(0);" (click)="toggleTeamCapacity()">Edit Capacity </a>-->
<!--            </span>-->

        </div>
          <div class="col text-right">
            <span *ngIf="sprintData && sprintData.id">
              <button class="m-l-10" [disabled]="isDisabledCreateBtn || activeSprintId || draftData && draftData.length==0" [nzLoading]="publishSprintInProcess" nzType="primary" nzSize="small" nz-button (click)="publishSprint()">Publish Sprint</button>
               <button class="m-l-10" *ngIf="!activeSprintId" nzType="link" [nzLoading]="saveSprintInProcess" nzSize="small" nz-button (click)="saveSprint()">Save Sprint</button>
            </span>

            <button *ngIf="sprintData && sprintData.id" nzSize="32" class="m-l-10" nz-button nz-dropdown [nzDropdownMenu]="menu1" nzPlacement="bottomRight" style="min-width: 32px;">
              <i class="fas fa-ellipsis-v"></i>
            </button>

            <nz-dropdown-menu #menu1="nzDropdownMenu">
              <ul nz-menu>
                <li nz-menu-item (click)="toggleAddSprint()" >Edit Sprint</li>
                <li nz-menu-item (click)="toggleTeamCapacity()">Edit Capacity</li>
              </ul>
            </nz-dropdown-menu>
          </div>
        </div>


        <div class="draft-sprint-box" *ngIf="sprintData && sprintData.id && draftData && draftData.length===0">
            <nz-empty
              [nzNotFoundImage]="'../../../assets/images/not-found/no-backlog.svg'"
              [nzNotFoundContent]="contentTpl">
              <ng-template #contentTpl>
                <span class="font-weight-normal font-size-13 text-gray-light-2">Select your backlogs to assign to the sprint <strong>{{sprintData.name}}</strong></span>
              </ng-template>

            </nz-empty>
        </div>
        <ng-container *ngIf="draftData && draftData.length>0">
          <div>

              <aavantan-task-list
                [taskByUser]="'all'"
                [taskList]="draftData"
                [sprintId]="sprintData.id"
                [isDraftTable]="true"
                [view]="view"
                [showLogOption]="false"
                [showCheckboxOption]="false"
                [showProgressOption]="false"
                (tasksSelectedForDraftSprint)="getTasksSelectedForSprint($event)"
              ></aavantan-task-list>

          </div>
        </ng-container>

<!-- old code -->
<!--        <ng-container *ngIf="sprintData && !sprintData.id && draftData && draftData.length===0">-->
<!--          <nz-empty-->
<!--            class="draft-sprint-box"-->
<!--            [nzNotFoundImage]="false"-->
<!--            [nzNotFoundContent]="contentTpl"-->
<!--            [nzNotFoundFooter]="footerTpl">-->

<!--            <ng-template #contentTpl>-->

<!--              <span *ngIf="!activeSprintId" class="font-size-16">You have <span class="text-danger">{{allTaskList ? allTaskList.length : '0'}} task</span> in backlog</span>-->
<!--              <span *ngIf="activeSprintId" class="font-size-16"><span class="text-success">"{{activeSprintData && activeSprintData.name ? activeSprintData.name : 'Sprint'}}"</span> is already running-->
<!--                <br><span class="text-gray-light font-size-12">(You cannot start other Sprint before completing this active Sprint)</span>-->
<!--              </span>-->

<!--            </ng-template>-->

<!--            <ng-template #footerTpl>-->
<!--              <button [disabled]="activeSprintId" nz-button nzSize="small" nzType="primary" class="btn-medium" (click)="toggleAddSprint()">+ Create Sprint</button>-->
<!--            </ng-template>-->
<!--          </nz-empty>-->
<!--        </ng-container>-->


      </nz-spin>

    </section>



    <section ngClass="{{sprintData && sprintData.id ? 'm-t-30' : 'm-t-10'}}">

      <div class="row m-b-10">
        <div class="col">
          <label class="font-size-18"><span class="text-black">Backlogs</span>

            <span class="p-l-25 text-gray-light-2 font-size-13" *ngIf="sprintData && sprintData.totalCapacityReadable">
              <span>{{sprintData?.totalCapacityReadable}}</span>
              <span class="font-weight-light"> Total Estimates</span>
            </span>

          </label>
        </div>

        <div class="col text-right" style="max-width: 320px;" *ngIf="allTaskList && allTaskList.length > 0">

          <nz-input-group [nzSuffix]="suffixIcon">
            <input placeholder="Search Backlogs" nzSize="small" nz-input [(ngModel)]="searchValue" (ngModelChange)="onChangeSearch($event)" style="height:32px;"/>
          </nz-input-group>
          <ng-template #suffixIcon>
            <i nz-icon nzType="search" *ngIf="!searchTaskListInProgress"></i>
            <i class="fas fa-spin fa-spinner" *ngIf="searchTaskListInProgress"></i>
          </ng-template>

        </div>

        <div class="col text-right p-l-0" style="max-width: 120px;" *ngIf="sprintData && !sprintData.id" >
          <button nz-button nzSize="small" nzType="{{!sprintData?.id && allTaskList && allTaskList.length > 0 ? 'primary' : 'default'}}" (click)="toggleAddSprint()">Create Sprint</button>
        </div>


      </div>

      <ng-container *ngIf="allTaskList && allTaskList.length > 0">

        <aavantan-task-list
          *ngIf="sprintData && sprintData.id"
          [sprintId]="sprintData.id"
          [showSorting]="true"
          [taskByUser]="'all'"
          [taskList]="allTaskList"
          [view]="view"
          [showLogOption]="false"
          [showCheckboxOption]="true"
          [showProgressOption]="false"
          (tasksSelectedForDraftSprint)="getTasksSelectedForSprint($event)"
        ></aavantan-task-list>
        <aavantan-task-list
          *ngIf="sprintData && !sprintData.id"
          [taskByUser]="'all'"
          [showSorting]="true"
          [taskList]="allTaskList"
          [view]="view"
          [showLogOption]="false"
          [showCheckboxOption]="true"
          [showProgressOption]="false"
          (tasksSelectedForDraftSprint)="getTasksSelectedForSprint($event)"
        ></aavantan-task-list>

      </ng-container>

      <div ngClass="{{allTaskList && allTaskList.length>0 ? 'btn-create-backlog': ''}}">
        <span class="text-primary cursor-pointer font-weight-normal font-size-13" (click)="addTaskNavigate()">+ Create Backlogs</span>
      </div>

      <ng-container *ngIf="allTaskList && allTaskList.length === 0">

        <nz-empty
          class="m-t-65"
          [nzNotFoundImage]="'../../../assets/images/not-found/no-backlog.svg'"
          [nzNotFoundContent]="footerTpl">
          <ng-template #footerTpl>
            No Backlogs!
          </ng-template>
        </nz-empty>

      </ng-container>

    </section>
  </nz-card>
</nz-spin>

<aavantan-team-capacity
  *ngIf="teamCapacityModalIsVisible"
  [sprintData]="sprintData"
  [teamCapacityModalIsVisible]="teamCapacityModalIsVisible"
  (toggleShow)="toggleTeamCapacity($event)">
</aavantan-team-capacity>

<aavantan-app-add-sprint
  *ngIf="sprintModalIsVisible"
  [sprintData]="sprintData"
  [sprintModalIsVisible]="sprintModalIsVisible"
  (toggleShow)="toggleAddSprint($event)">
</aavantan-app-add-sprint>
