<nz-spin nzTip="Loading..." [nzSpinning]="getTaskInProcess">
  <nz-card
    nzSize="small"
    [nzBordered]="false"
    [nzTitle]="titleTemplateRef"
    [nzExtra]="createSprintBtnTemplate">
    <ng-template #titleTemplateRef>

      <span class="p-r-30">
        <span class="p-r-15 font-size-18 text-black">Backlog/Sprint</span>
        <img src="../../../assets/images/icons/info.svg" height="16" nz-tooltip nzTooltipTitle="About Backlog page..."/>
      </span>

      <span class="badge backlog-badge">
        <span class="text-red">Total Backlogs</span><span class="p-l-5 text-black">{{durationData?.readable}}</span>
      </span>


    </ng-template>
    <ng-template #createSprintBtnTemplate>

      <button nzType="link" nzSize="small" class="btn-medium m-r-10" nz-button (click)="publishSprint()">Save Sprint</button>

      <button [disabled]="isDisabledCreateBtn" [nzLoading]="publishSprintInProcess" nzType="primary" nzSize="small" class="btn-medium" nz-button (click)="publishSprint()">Publish Sprint</button>

    </ng-template>


    <section class="m-b-20">
      <nz-spin nzTip="Checking Unpublished Sprint..." [nzSpinning]="gettingUnpublishedInProcess">
        <div class="clearfix m-b-10" *ngIf="sprintData && sprintData.id">

            <span class="font-size-14 font-weight-light">
              <span class="font-size-18 m-r-30 text-black font-weight-normal">{{sprintData.name}}</span>
              <span class="text-gray-light m-r-25">Capacity <span class="text-black font-weight-normal">{{sprintData.totalCapacityReadable}}</span></span>
              <span class="text-success m-r-10" *ngIf="sprintData.totalEstimationReadable"><span>Total</span><strong class="p-l-5">{{sprintData?.totalEstimationReadable}}</strong></span>
              <span class="text-gray-light font-size-12" *ngIf="sprintData.totalRemainingCapacityReadable"><span>Remains</span><strong class="p-l-5">{{sprintData?.totalRemainingCapacityReadable}}</strong></span>
            </span>

            <span class="float-right font-weight-light" >
              <a href="javascript:void(0);" (click)="toggleAddSprint()" class="p-r-25">Edit Sprint </a>
              <a href="javascript:void(0);" (click)="toggleTeamCapacity()">Edit Capacity </a>
            </span>

        </div>
        <div class="draft-sprint-box" *ngIf="sprintData && sprintData.id && draftData && draftData.length===0">
            <nz-empty
              [nzNotFoundImage]="false"
              [nzNotFoundContent]="contentTpl"
              [nzNotFoundFooter]="footerTpl">
              <ng-template #contentTpl>
                <span>Select backlog items to move into <strong>{{sprintData.name}}</strong></span>
              </ng-template>
              <ng-template #footerTpl>
                <button nz-button nzSize="small" nzType="primary" class="btn-medium" (click)="toggleAddSprint()">Edit {{sprintData.name}}</button>
              </ng-template>
            </nz-empty>
        </div>
        <ng-container *ngIf="draftData && draftData.length>0">
          <div>

              <aavantan-task-list
                [taskByUser]="'all'"
                [taskList]="draftData"
                [sprintId]="sprintData.id"
                [showRemoveIcon]="true"
                [view]="view"
                [showLogOption]="false"
                [showCheckboxOption]="false"
                [showProgressOption]="false"
              ></aavantan-task-list>

          </div>
        </ng-container>
        <ng-container *ngIf="sprintData && !sprintData.id && draftData && draftData.length===0">
          <nz-empty
            class="draft-sprint-box p-20"
            [nzNotFoundImage]="false"
            [nzNotFoundContent]="contentTpl"
            [nzNotFoundFooter]="footerTpl">
            <ng-template #contentTpl>
              <span class="font-size-16">You have <span class="text-danger">16 task</span> in backlog</span>
            </ng-template>
            <ng-template #footerTpl>
              <button nz-button nzSize="small" nzType="primary" class="btn-medium" (click)="toggleAddSprint()">+ Create Sprint</button>
            </ng-template>
          </nz-empty>
        </ng-container>
      </nz-spin>

    </section>



    <section>

      <div class="row">
        <div class="col">
          <label class="font-size-18"><span class="text-black">Backlogs</span> <small class="p-l-25 font-size-14"><span class="text-gray-light">Total </span><span class="text-black">{{durationData?.readable}}</span></small></label>
        </div>
        <div class="col text-right" style="max-width: 320px;">

          <nz-input-group [nzSuffix]="suffixIcon">
            <input placeholder="Search By Title, Task type, Assignee" nzSize="small" nz-input [(ngModel)]="searchValue" (ngModelChange)="onChangeSearch($event)" style="height:29px;"/>
          </nz-input-group>
          <ng-template #suffixIcon>
            <i nz-icon nzType="search" *ngIf="!searchTaskListInProgress"></i>
            <i class="fas fa-spin fa-spinner" *ngIf="searchTaskListInProgress"></i>
          </ng-template>

        </div>
      </div>

      <ng-container *ngIf="allTaskList && allTaskList.length > 0">

        <aavantan-task-list
          *ngIf="sprintData && sprintData.id"
          [sprintId]="sprintData.id"
          [showSorting]="true"
          [taskByUser]="'all'"
          [taskList]="allTaskList"
          [view]="view"
          [showLogOption]="false"
          [showCheckboxOption]="true"
          [showProgressOption]="false"
          (tasksSelectedForDraftSprint)="getTasksSelectedForSprint($event)"
        ></aavantan-task-list>
        <aavantan-task-list
          *ngIf="sprintData && !sprintData.id"
          [taskByUser]="'all'"
          [showSorting]="true"
          [taskList]="allTaskList"
          [view]="view"
          [showLogOption]="false"
          [showCheckboxOption]="true"
          [showProgressOption]="false"
          (tasksSelectedForDraftSprint)="getTasksSelectedForSprint($event)"
        ></aavantan-task-list>

      </ng-container>

      <ng-container *ngIf="allTaskList && allTaskList.length === 0">
        <div class="text-center text-muted p-t-50 p-t-20">
          <h3>No Data Found</h3>
        </div>
      </ng-container>

    </section>
  </nz-card>
</nz-spin>

<aavantan-team-capacity
  [sprintData]="sprintData"
  [teamCapacityModalIsVisible]="teamCapacityModalIsVisible"
  (toggleShow)="toggleTeamCapacity($event)">
</aavantan-team-capacity>

<aavantan-app-add-sprint
  *ngIf="sprintModalIsVisible"
  [sprintData]="sprintData"
  [sprintModalIsVisible]="sprintModalIsVisible"
  (toggleShow)="toggleAddSprint($event)">
</aavantan-app-add-sprint>
