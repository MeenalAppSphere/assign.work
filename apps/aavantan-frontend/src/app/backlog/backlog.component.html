<nz-spin nzTip="Loading..." [nzSpinning]="getTaskInProcess">
  <nz-card
    nzSize="small"
    [nzBordered]="false"
    [nzTitle]="titleTemplateRef"
    [nzExtra]="createSprintBtnTemplate"
    class="backlog-page">
    <ng-template #titleTemplateRef>

      <span class="p-r-30">
        <span class="p-r-15 font-size-18 text-black">Backlog/Sprint</span>
        <img src="../../../assets/images/icons/info.svg" height="16" nz-tooltip nzTooltipTitle="About Backlog page..."/>
      </span>

      <!--      <span class="badge backlog-badge" *ngIf="sprintData && sprintData?.totalEstimationReadable">-->
      <!--        <span class="text-red">Total Backlogs</span><span class="p-l-5 text-black">{{sprintData?.totalEstimationReadable}}</span>-->
      <!--      </span>-->

    </ng-template>
    <ng-template #createSprintBtnTemplate>
      <span *ngIf="activeSprintData && activeSprintData.name"
            class="text-gray-light font-size-16">{{activeSprintData.name}} <span
        class="text-gray-light-2">is running</span></span>
    </ng-template>


    <section class="m-b-10">
      <nz-spin nzTip="Checking Unpublished Sprint..." [nzSpinning]="gettingUnpublishedInProcess">


        <div class="row clearfix m-b-10 m-t-10">

          <div class="col" *ngIf="unPublishedSprintData && unPublishedSprintData.id">
            <span class="font-size-14">

              <span class="font-size-18 m-r-30 text-black font-weight-normal">{{unPublishedSprintData.name}}</span>

              <span class="m-r-25 text-gray-light-2 font-size-13" *ngIf="unPublishedSprintData.totalEstimationReadable">
                <span>{{unPublishedSprintData?.totalEstimationReadable}}</span>
                <span class="font-weight-light">  Sprint Hours </span>
              </span>

              <span class="m-r-10 text-gray-light-2 font-size-13">
                <span>{{unPublishedSprintData.totalCapacityReadable}}</span>
                <span class="m-r-25 font-weight-light"> Sprint Capacity</span>
              </span>


              <span class="font-size-12 font-size-13"
                    [ngClass]="{'text-gray-light-2': unPublishedSprintData.totalRemainingCapacity>0, 'text-red': unPublishedSprintData.totalRemainingCapacity<0}"
                    *ngIf="unPublishedSprintData.totalRemainingCapacityReadable">
                <span class="p-l-5">{{unPublishedSprintData?.totalRemainingCapacityReadable}}</span>
                <span class="font-weight-light"> Remains</span>
              </span>
            </span>
          </div>


          <div class="col text-right">
            <span *ngIf="activeSprintData?.id ||  (unPublishedSprintData?.id)">
              <button class="m-l-10" [disabled]="!haveUnpublishedTasks" [nzLoading]="publishSprintInProcess"
                      nzType="primary" nzSize="small" nz-button (click)="publishSprint()">Publish Sprint</button>
              <button class="m-l-10" [nzLoading]="saveSprintInProcess" nzType="link" nzSize="small" nz-button
                      (click)="saveSprint()">Save Sprint</button>
            </span>

            <button *ngIf="unPublishedSprintData && unPublishedSprintData.id" nzSize="32" class="m-l-10" nz-button
                    nz-dropdown [nzDropdownMenu]="menu1" nzPlacement="bottomRight" style="min-width: 32px;">
              <i class="fas fa-ellipsis-v"></i>
            </button>

            <nz-dropdown-menu #menu1="nzDropdownMenu">
              <ul nz-menu>
                <li nz-menu-item (click)="toggleAddSprint()">Edit Sprint</li>
                <li nz-menu-item (click)="toggleTeamCapacity()">Edit Capacity</li>
              </ul>
            </nz-dropdown-menu>
          </div>
        </div>


        <div class="draft-sprint-box"
             *ngIf="unPublishedSprintData && unPublishedSprintData.id && draftData && draftData.length===0">
          <nz-empty
            [nzNotFoundImage]="'../../../assets/images/not-found/no-backlog.svg'"
            [nzNotFoundContent]="contentTpl">
            <ng-template #contentTpl>
              <span class="font-weight-normal font-size-13 text-gray-light-2">Select your backlogs to assign to the sprint <strong>{{unPublishedSprintData.name}}</strong></span>
            </ng-template>

          </nz-empty>
        </div>
        <ng-container>

          <div *ngIf="activeSprintData?.id || unPublishedSprintData?.id">

            <aavantan-task-list
              [taskByUser]="'all'"
              [taskList]="draftData"
              [sprintId]="unPublishedSprintData.id"
              [activeSprintId]="activeSprintData?.id"
              [isDraftTable]="true"
              [view]="view"
              [showLogOption]="false"
              [showCheckboxOption]="false"
              [showProgressOption]="false"
              (tasksSelectedForDraftSprint)="getTasksSelectedForSprint($event)">
            </aavantan-task-list>

          </div>

        </ng-container>


      </nz-spin>

    </section>


    <section ngClass="{{unPublishedSprintData && unPublishedSprintData.id ? 'm-t-30' : 'm-t-10'}}">

      <div class="row m-b-10">
        <div class="col">
          <label class="font-size-18"><span class="text-black">Backlogs</span>

            <span class="p-l-25 text-gray-light-2 font-size-13"
                  *ngIf="unPublishedSprintData && unPublishedSprintData.totalCapacityReadable">
              <span>{{unPublishedSprintData?.totalCapacityReadable}}</span>
              <span class="font-weight-light"> Total Estimates</span>
            </span>

          </label>
        </div>

        <div class="col text-right" style="max-width: 320px;" *ngIf="backLogTasksList && backLogTasksList.length > 0">

          <nz-input-group [nzSuffix]="suffixIcon">
            <input placeholder="Search Backlogs" nzSize="small" nz-input [(ngModel)]="searchValue"
                   (ngModelChange)="onChangeSearch($event)" style="height:32px;"/>
          </nz-input-group>
          <ng-template #suffixIcon>
            <i nz-icon nzType="search" *ngIf="!searchTaskListInProgress"></i>
            <i class="fas fa-spin fa-spinner" *ngIf="searchTaskListInProgress"></i>
          </ng-template>

        </div>

        <div class="col text-right p-l-0" style="max-width: 120px;"
             *ngIf="!activeSprintData?.id && !unPublishedSprintData?.id">
          <button nz-button nzSize="small"
                  nzType="{{!unPublishedSprintData?.id && backLogTasksList && backLogTasksList.length > 0 ? 'primary' : 'default'}}"
                  (click)="toggleAddSprint()">Create Sprint
          </button>
        </div>


      </div>

      <ng-container *ngIf="backLogTasksList && backLogTasksList.length > 0">

        <aavantan-task-list
          [sprintId]="unPublishedSprintData?.id"
          [activeSprintId]="activeSprintData?.id"
          [showSorting]="true"
          [taskByUser]="'all'"
          [taskList]="backLogTasksList"
          [view]="view"
          [showLogOption]="false"
          [showCheckboxOption]="true"
          [showProgressOption]="false"
          (tasksSelectedForDraftSprint)="getTasksSelectedForSprint($event)"
        ></aavantan-task-list>


      </ng-container>

      <div ngClass="{{backLogTasksList && backLogTasksList.length>0 ? 'btn-create-backlog': ''}}">
        <a href="javascript:void(0);" class="text-primary cursor-pointer font-weight-normal font-size-13"
           (click)="addTaskNavigate()">+ Create Backlog</a>
      </div>

      <ng-container *ngIf="backLogTasksList && backLogTasksList.length === 0">

        <nz-empty
          class="m-t-65"
          [nzNotFoundImage]="'../../../assets/images/not-found/no-backlog.svg'"
          [nzNotFoundContent]="footerTpl">
          <ng-template #footerTpl>
            No Backlogs!
          </ng-template>
        </nz-empty>

      </ng-container>

    </section>


  </nz-card>
</nz-spin>

<aavantan-team-capacity
  *ngIf="teamCapacityModalIsVisible"
  [sprintData]="unPublishedSprintData"
  [teamCapacityModalIsVisible]="teamCapacityModalIsVisible"
  (toggleShow)="toggleTeamCapacity($event)">
</aavantan-team-capacity>

<aavantan-app-add-sprint
  *ngIf="sprintModalIsVisible"
  [sprintData]="unPublishedSprintData"
  [sprintModalIsVisible]="sprintModalIsVisible"
  (toggleShow)="toggleAddSprint($event)">
</aavantan-app-add-sprint>
