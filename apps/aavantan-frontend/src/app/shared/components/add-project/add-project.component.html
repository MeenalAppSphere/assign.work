<nz-modal [(nzVisible)]="projectModalIsVisible" nzClassName="project-modal" nzFooter="#nzModalFooter" nzWidth="700" nzClosable="false">


    <nz-spin nzTip="Setting up..." [nzSpinning]="switchingProjectInProcess">

        <div *ngIf="!showCreateProject && projectList && projectList.length>0" style="min-height:500px;">
            <h5 class="m-b-10">Switch Project</h5>
            <div class="horizontal-list">
                <h4>Recent Project</h4>
                <nz-list [nzDataSource]="projectList" [nzRenderItem]="item" [nzItemLayout]="'horizontal'">
                    <ng-template #item let-item>

                        <nz-list-item (click)="switchProject(item)" class="horizontal-list">

                            <nz-list-item-meta [nzTitle]="nzTitle">
                                <ng-template #nzTitle>
                                    <div class="project-header-title p-10 p-t-15 p-b-15">
                                        <nz-avatar class="m-r-10" nzText="{{item.name | slice : 0:2}}"></nz-avatar>
                                        <span>{{item.name}}</span>
                                    </div>
                                    <div class="font-size-13 p-10">
                                        <span>
                                      <span class="font-size-12 text-muted">Created : {{item.createdAt | dateAgo}}</span>
                                        <span class="float-right"><nz-avatar class="m-r-5" nzSize="small" nzText="{{(item.createdBy && item.createdBy.firstName ? item.createdBy.firstName : 'AW') | slice : 0:1}}"></nz-avatar>By : {{item.createdBy && item.createdBy.firstName ? item.createdBy.firstName : 'NA'}}</span>
                                        </span>
                                        <!-- <p nz-paragraph nzEllipsis nzExpandable [nzEllipsisRows]="3">{{item.description}}</p> -->
                                    </div>
                                </ng-template>
                            </nz-list-item-meta>

                        </nz-list-item>

                    </ng-template>
                </nz-list>
            </div>
            <div class="p-10">
                <nz-form-item class="m-b-5">
                    <nz-form-control>
                        <nz-input-group [nzSuffix]="suffixIconSearch">
                            <input placeholder="Search Project" (ngModelChange)="changed()" [(ngModel)]="searchProjectText" nz-input nzSize="small" />
                        </nz-input-group>
                        <ng-template #suffixIconSearch>
                            <i nz-icon nzType="search" *ngIf="!isSearching"></i>
                          <i class="fas fa-spin fa-spinner" *ngIf="isSearching"></i>
                        </ng-template>
                    </nz-form-control>
                </nz-form-item>
                <div class="search-list">
                    <nz-list [nzDataSource]="projectListSearch" [nzRenderItem]="item1" [nzItemLayout]="'horizontal'">
                        <ng-template #item1 let-item>

                            <nz-list-item (click)="switchProject(item)">

                                <nz-list-item-meta [nzTitle]="nzTitle">
                                    <ng-template #nzTitle>
                                        <div class="project-header-title p-10">
                                            <nz-avatar class="m-r-10" nzText="{{item.name | slice : 0:2}}"></nz-avatar>
                                            <span>{{item.name}}</span>
                                            <div class="font-size-12 float-right" style="display: inline-block;">
                                                <span>
                                                  <span class="float-right font-size-12 text-muted">Created : {{item.createdAt | dateAgo}}</span><br/>
                                                  <span class="float-right"><nz-avatar class="m-r-5" nzSize="small" nzText="{{(item.createdBy && item.createdBy.firstName ? item.createdBy.firstName : 'AW') | slice : 0:1}}"></nz-avatar>By : {{item.createdBy && item.createdBy.firstName ? item.createdBy.firstName : 'NA'}}</span>
                                                </span>
                                            </div>
                                        </div>
                                    </ng-template>
                                </nz-list-item-meta>
                            </nz-list-item>

                        </ng-template>
                    </nz-list>
                </div>
            </div>
        </div>


        <div class="steps-action" *ngIf="showCreateProject">

            <div class="text-center m-t-20 text-black">
                <h4 class="m-0 text-black">Welcome to Assign.work</h4>
                <p *ngIf="switchStepCurrent===0" class="m-b-20 text-black">Wanna add your first project?</p>
                <p *ngIf="switchStepCurrent===1" class="m-b-20 text-black">Add or Invite project collaborators</p>
                <p *ngIf="switchStepCurrent===2" class="m-b-20 text-black">Select template for your Project</p>
            </div>

          <div class="p-l-40 p-r-40">
            <nz-steps [nzCurrent]="switchStepCurrent">
                <nz-step nzTitle="Project">Project</nz-step>
                <nz-step nzTitle="Collaborators">Collaborators</nz-step>
                <nz-step nzTitle="Template">Template</nz-step>
            </nz-steps>
          </div>

            <!--first-->
            <ng-container *ngIf="switchStepCurrent===0">
                <form nz-form class="register-form" [formGroup]="projectForm">

                    <div class="min-height-100 m-t-25">
                        <nz-form-item>
                            <nz-form-label nzRequired nzFor="name">Project Name<span class="text-danger">*</span></nz-form-label>
                            <nz-form-control [nzValidatingTip]="errorTpl">
                                <input nz-input formControlName="name" placeholder="Enter Project Name, eg : Food Application" autocomplete="Off" nzSize="small" id="name">
                                <nz-form-explain *ngIf="projectForm.get('name').dirty && projectForm.get('name').errors">
                                    Please Enter Project Name! <small class="text-muted"> (Allowed Alphanumeric only)</small>
                                </nz-form-explain>

                                <ng-template #errorTpl let-control>
                                    <ng-container *ngIf="projectForm.hasError('required')">
                                        Please Enter Project Name! <small class="text-muted"> (Allowed Alphanumeric only)</small>
                                    </ng-container>
                                </ng-template>
                            </nz-form-control>
                        </nz-form-item>

                        <nz-form-item>
                            <nz-form-label nzFor="description">Description</nz-form-label>
                            <nz-form-control>
                                <textarea formControlName="description" nz-input rows="3" placeholder="Write something about your project..."></textarea>
                            </nz-form-control>
                        </nz-form-item>

                    </div>
                </form>
            </ng-container>

            <!-- second-->
            <ng-container *ngIf="switchStepCurrent===1" class="h-100">

              <div class="min-height-100 m-t-25">
                <form nz-form [formGroup]="collaboratorForm">
                  <div class="form-group">

                    <nz-form-item>
                      <div class="mb-1 collaborators-badge" *ngIf="selectedCollaborators && selectedCollaborators.length>0">
                          <span class="badge badge-secondary" *ngFor="let item of selectedCollaborators">
                            <nz-avatar *ngIf="item.id" nzSize="small" nzIcon="user" [nzSrc]="item.profilePic"></nz-avatar>
                            <i class="fa fa-envelope" *ngIf="!item.id"></i>
                            &nbsp;<span *ngIf="item.firstName">{{item.firstName}} {{item.lastName}}</span>
                            <span *ngIf="!item.firstName">{{item.emailId}}</span>
                            <i class="fa fa-times" (click)='removeCollaborators(item)'></i>
                          </span>
                      </div>
                      <nz-form-control class="relative">
                        <nz-input-group [nzSuffix]="suffixIconSearch">
                          <input placeholder="Search Collaborators" formControlName="collaborator" class="assigned-user-input" nz-input (ngModelChange)="selectAssigneeTypeahead($event)" nzSize="small" [nzAutocomplete]="autoAssignee" (keydown)="onKeydown($event)"/>
                        </nz-input-group>
                        <nz-autocomplete #autoAssignee>
                          <nz-auto-option *ngFor="let option of collaboratorsDataSource" [nzLabel]="option && option.firstName ? option.firstName : option.emailId" [nzValue]="option">
                            <nz-avatar class="m-r-10" [nzSrc]="option && option.profilePic ? option.profilePic : ''" [nzShape]="'circle'" [nzSize]="'small'" [nzIcon]="'user'"></nz-avatar>
                            <span>{{ option && option.firstName ? option.firstName : option.emailId }}</span>
                            <span *ngIf="option && option.lastName">{{ option && option.lastName }}</span>
                            <div *ngIf="option && option.firstName" style="margin-top: -6px;" class="p-l-35"><small class="text-muted">{{ option.emailId }}</small></div>
                          </nz-auto-option>
                        </nz-autocomplete>
                      </nz-form-control>
                      <ng-template #suffixIconSearch>
                        <i nz-icon nzType="search" *ngIf="!isSearching"></i>
                        <i class="fas fa-spin fa-spinner" *ngIf="isSearching"></i>
                      </ng-template>
                    </nz-form-item>

                    <nz-form-explain class="text-danger" *ngIf="response && response.message">{{response.message}}</nz-form-explain>
                  </div>
                </form>
              </div>


<!--                <div class="min-height-100 m-t-25">-->

<!--                    <div class="form-group">-->
<!--                        <label>Collaborators</label>-->
<!--                        <div class="mb-1 collaborators-badge" *ngIf="selectedCollaborators && selectedCollaborators.length>0">-->
<!--                            <span class="badge badge-secondary" *ngFor="let item of selectedCollaborators">-->
<!--                              <nz-avatar *ngIf="item.id" nzSize="small" nzIcon="user" [nzSrc]="item.profilePic"></nz-avatar>-->
<!--                              <i class="fa fa-envelope" *ngIf="!item.id"></i>-->
<!--                              &nbsp;<span *ngIf="item.firstName">{{item.firstName}} {{item.lastName}}</span>-->
<!--                              <span *ngIf="!item.firstName">{{item.emailId}}</span>-->
<!--                              <i class="fa fa-times" (click)='removeCollaborators(item)'></i>-->
<!--                            </span>-->
<!--                        </div>-->

<!--                        <input autocomplete="Off" (typeaheadOnSelect)="typeaheadOnSelect($event)" [(ngModel)]="selectedCollaborator" [typeahead]="members" typeaheadOptionField="emailId" placeholder="Search or Invite people" (keydown)="onKeydown($event)" nz-input nzSize="small">-->
<!--                        <nz-form-explain class="text-danger" *ngIf="response && response.message">{{response.message}}</nz-form-explain>-->
<!--                    </div>-->
<!--                </div>-->
            </ng-container>

            <!--third-->
            <ng-container *ngIf="switchStepCurrent===2">
                <div class="min-height-100 m-t-25">
                    <p class="m-t-25 m-b-10 text-uppercase">Select template for your Project</p>
                    <div class="text-center">
                        <nz-radio-group [(ngModel)]="selectedTemplate" class="project-templates" [nzButtonStyle]="'solid'">
                            <label nz-radio-button nzValue="Software Development">
                              <img *ngIf="selectedTemplate!=='Software Development'" src="../../../../assets/images/icons/template_software.svg" alt="Software Development"/>
                              <img *ngIf="selectedTemplate==='Software Development'" src="../../../../assets/images/icons/template_software_white.svg" alt="Software Development"/>
                              <div>Software</div>
                            </label>
                            <label nz-radio-button nzValue="Task Management">
                              <img *ngIf="selectedTemplate!=='Task Management'" src="../../../../assets/images/icons/template_task_management.svg" alt="Task Management"/>
                              <img *ngIf="selectedTemplate==='Task Management'" src="../../../../assets/images/icons/template_task_management_white.svg" alt="Task Management"/>
                              <div>Task Management</div>
                            </label>
                            <label nz-radio-button nzValue="Accounts">
                              <img *ngIf="selectedTemplate!=='Accounts'" src="../../../../assets/images/icons/template_accounts.svg" alt="Accounts"/>
                              <img *ngIf="selectedTemplate==='Accounts'" src="../../../../assets/images/icons/template_accounts_white.svg" alt="Accounts"/>
                              <div>Accounts</div>
                            </label>
                            <label nz-radio-button nzValue="Production">
                              <img *ngIf="selectedTemplate!=='Production'" src="../../../../assets/images/icons/template_production.svg" alt="Production"/>
                              <img *ngIf="selectedTemplate==='Production'" src="../../../../assets/images/icons/template_production_white.svg" alt="Production"/>
                              <div>Production</div>
                            </label>
                        </nz-radio-group>
                    </div>
                </div>
            </ng-container>

        </div>

        <div *nzModalFooter>
            <div class="row">


                <div class="col text-right">

                  <!-- cancel -->
                  <button *ngIf="!createdProjectId" nz-button nzType="default" nzSize="small" (click)="basicModalHandleCancel()" [disabled]="organizationCreationInProcess"><span>Cancel</span></button>

                  <button *ngIf="createdProjectId" nz-button nzType="default" nzSize="small" (click)="basicModalHandleCancel()"><span>Close</span></button>
                  <!-- cancel btn end -->


                    <button nz-button nzType="primary" nzSize="small" class="m-r-5" (click)="pre()" *ngIf="showCreateProject && switchStepCurrent > 1 && !createdProjectId"><span>Previous</span></button>

                    <button nz-button nzType="default" nzSize="small" (click)="skip()" *ngIf="showCreateProject && switchStepCurrent === 1"><span>Skip</span></button>

                    <button nz-button nzType="primary" nzSize="small" (click)="next()" *ngIf="showCreateProject && switchStepCurrent < 2" [nzLoading]="createProjectInProcess || addCollaboratorsInProcess"><span>Next</span></button>

                    <button nz-button nzType="primary" nzSize="small" (click)="addTemplate()" *ngIf="showCreateProject && switchStepCurrent === 2" [nzLoading]="selectTemplateInProcess"><span>Done</span></button>

                    <button *ngIf="!showCreateProject" nz-button nzShape="round" type="button" nzType="link" class="float-right" (click)="addNewProject()">+ Add New Project</button>

                </div>
            </div>
        </div>

    </nz-spin>
</nz-modal>
