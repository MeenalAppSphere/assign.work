<div class="container-fluid p-0">
    <div class="row" *ngIf="view == 'cardView'">
        <div class="col-md-3" *ngFor="let item of taskList" >

            <nz-card nzSize="small" class="card-view-card" [ngStyle]="{'border-left':'solid 4px '+item.priority?.color+''}">

              <div class="clearfix m-b-10 font-size-12">

                <span class="d-inline-block p-t-5" [ngStyle]="{'color': item.taskType && item.taskType.color ? item.taskType.color : '#0667FB'}" [nzTitle]="item.taskType && item.taskType.name ? item.taskType.name : ''" nz-tooltip>#{{item.displayName}}</span>

                <span class="float-right">
                  <nz-tag *ngIf="item.status && item.status.name" [nzColor]="'#F1F2F4'" style="text-transform: initial;" class="text-black">{{item.status.name}}</nz-tag>
                  <nz-tag *ngIf="!item.status" [nzColor]="'#F1F2F4'" class="text-black">-</nz-tag>
                </span>

              </div>

              <div class="d-flex justify-content-between m-b-10">
                    <div class="media" style="height: 40px">

                        <a href="javascript:void(0)" (click)="viewTask(item)">
                            <p nz-paragraph nzEllipsis [nzEllipsisRows]="2" class="text-black m-0">{{item.displayName}}: {{item.name}}</p>
                        </a>

                    </div>
                </div>


                <div class="m-t-10 font-size-13">
                    <div class="d-flex justify-content-between align-items-center" style="min-height:24px;">

                      <span>{{item.estimatedTimeReadable ? item.estimatedTimeReadable : 0 }}</span>

                      <span>
                        <a *ngIf="showLogOption" (click)="timeLog(item)" href="javascript:void(0);" class="text-primary"><i nz-icon nzType="clock-circle" theme="outline"></i> Log Time</a>
                      </span>


                    </div>
                </div>

                <div *ngIf="showProgressOption" class="progress-box-section">
                  <div class="d-flex justify-content-between">
                    <span class="text-gray-light">Progress<span class="font-weight-semibold text-black font-weight-bold p-l-5">{{item.progress ? item.progress : '0'}}%</span></span>
                    <span>
                      <span *ngIf="!item.assignee">
                        <nz-avatar nzSize="small" nzIcon="user"></nz-avatar>
                      </span>
                      <span *ngIf="item.assignee">
                        <nz-avatar style="margin-top: -10px;" nzSize="small" nzIcon="user" [nzSrc]="item.assignee.profilePic" nz-tooltip [nzTitle]="item.assignee && item.assignee.firstName ? item.assignee.firstName : ''"></nz-avatar>
                        <div class="d-inline-block user-name p-l-5 text-black">{{item.assignee && item.assignee.firstName ? item.assignee.firstName : item.assignee.emailId}}</div>
                      </span>
                    </span>
                  </div>
                </div>

            </nz-card>
        </div>
    </div>

  <nz-spin [nzSpinning]="addTaskToSprintInProgress || removeTaskFromSprintInProgress" [nzTip]="addTaskToSprintInProgress ? 'Adding Task to Sprint...' : 'Removing Task from Sprint...'">
    <nz-table #listViewTable [nzData]="taskList" *ngIf="view == 'listView'" nzSize="small" [ngClass]="{'draft-table':isDraftTable}">
        <thead>
            <tr>

              <th class="text-center" width="50" *ngIf="isDraftTable">#</th>

              <th class="text-center" width="50" *ngIf="showCheckboxOption && (activeSprintId || tasksSelected?.sprintId)">#</th>

              <th class="text-left" style="min-width:115px;">
                <span>Priority</span>
                <span class="p-l-10" *ngIf="showSorting">
                  <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'priority'}"></ng-container>
                </span>
              </th>

                <th class="text-left" width="155">
                  <span>Type</span>
                  <span class="p-l-10" *ngIf="showSorting">
                      <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'taskType'}"></ng-container>
                    </span>
                </th>

                <th style="min-width: 400px; max-width: 40%;">
                  <span>Title</span>
                </th>

                <th class="text-center" *ngIf="showProgressOption">Progress</th>

                <th class="text-center" width="110">
                  <span>Status</span>
                </th>

                <th class="text-left" width="160">Member</th>

                <th class="text-right" width="125">
                  <span>Estimates</span>
                  <span class="p-l-10" *ngIf="showSorting">
                    <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'estimatedTime'}"></ng-container>
                  </span>
                </th>

            </tr>
        </thead>

        <tbody>
            <tr *ngFor="let item of listViewTable.data" [ngClass]="{'has-missing-data':(tasksSelected && tasksSelected.sprintId) && (!item.assignee || !item.estimatedTime) }">

                <td data-label="#" *ngIf="isDraftTable" class="text-center">
                  <i *ngIf="isDraftTable" (click)="deselectTaskFromSprint(item)" nz-icon nzType="close-circle" class="remove-item cursor-pointer text-muted" theme="fill"></i>
                </td>

                <td data-label="#" *ngIf="showCheckboxOption && (activeSprintId || tasksSelected?.sprintId)" class="text-center">

                  <label *ngIf="item.assignee && item.estimatedTime" nz-checkbox [(ngModel)]="item.isSelected"
                         (nzCheckedChange)="selectTaskForSprint(item, $event)"></label>

                  <i *ngIf="(tasksSelected && tasksSelected.sprintId) && (!item.assignee || !item.estimatedTime)"
                     class="text-red"
                     nz-icon nz-tooltip nzTitle="Assignee or Estimated time is missing" nzType="exclamation-circle"
                     style="margin-left: -8px;" theme="fill"></i>
                </td>

                <td data-label="Priority" class="text-left">
                  <span *ngIf="item && item.priority">
                    <i [ngStyle]="{'border-left':'solid 3px '+item.priority.color+'', 'height':'15px' }"></i>
                  </span>
                  <i *ngIf="!item.priority" [ngStyle]="{'border-left':'solid 3px #ffffff', 'height':'15px' }"></i>
                  <span class="p-l-5">{{item.priority && item.priority.name ? item.priority.name : '-'}}</span>
                </td>

                <td data-label="Type" class="text-left">
                  <span *ngIf="!item.taskType">-</span>
                  <a href="javascript:void(0);" (click)="viewTask(item)" *ngIf="item.taskType && item.taskType.name" [ngStyle]="{'color': item.taskType.color}">#{{item.displayName}}</a>
                </td>

                <td data-label="Title">
                    <div class="media align-items-center">

                        <div class="">

                            <h6 class="m-b-0">
                                <p class="m-0" style="max-width: 400px;" nz-paragraph nzEllipsis [nzEllipsisRows]="1">
                                    <a href="javascript:void(0)" (click)="viewTask(item)" class="text-black">
                                      {{item.name}}
                                    </a>
                                </p>
                            </h6>

                        </div>
                    </div>
                </td>

                <td *ngIf="showProgressOption" data-label="Progress" class="text-center">
                    <span *ngIf="!item.progress">-</span>
                    <span *ngIf="item.progress">{{item.progress}}%</span>
                </td>

                <td data-label="Status" class="text-center">
                    <span *ngIf="!item.status">-</span>
                    <nz-tag *ngIf="item.status && item.status.name" [nzColor]="'#F1F2F4'">
                      <p class="status-tag-lable m-0 text-black" nz-paragraph nzEllipsis [nzEllipsisRows]="1" nz-tooltip [nzTitle]="item.status && item.status.name ? item.status.name : ''">{{item.status.name}}</p>
                    </nz-tag>
                </td>

                <td data-label="Members" class="text-left">
                  <span *ngIf="!item.assignee">-</span>
                  <span *ngIf="item.assignee" nz-tooltip [nzTitle]="item.assignee && item.assignee.firstName ? item.assignee.firstName : item.assignee.emailId"> <nz-avatar nzSize="small" nzIcon="user" class="m-r-5" [nzSrc]="item.assignee.profilePic" ></nz-avatar>
                    <p class="assignee-name text-black" nz-paragraph nzEllipsis [nzEllipsisRows]="1">{{item.assignee && item.assignee.firstName ? item.assignee.firstName : item.assignee.emailId}}</p></span>
                </td>

                <td data-label="Estimate" class="text-right">
                    <span class="text-black display-block">{{item.estimatedTimeReadable}}</span><a href="javascript:void(0);" class="float-right text-primary" *ngIf="showLogOption" (toggleTimeLogShow)="toggleTimeLog($event, item)" (click)="timeLog(item)">&nbsp;<i nz-icon nzType="clock-circle" theme="outline"></i> Log Time</a>
                </td>

            </tr>
        </tbody>
    </nz-table>
  </nz-spin>

</div>


<!-- sorting icon template -->
<ng-template #sortTemplate let-column="column">

  <i class="fas fa-long-arrow-alt-up" *ngIf="sortingRequest.sortBy !== column" (click)="sortButtonClicked('asc', column)" [ngClass]="{'text-info': sortingRequest.sortBy === column && sortingRequest.sort === 'asc'}"></i>

  <i class="fas fa-long-arrow-alt-up" *ngIf="sortingRequest.sortBy === column && sortingRequest.sort === 'asc'" (click)="sortButtonClicked('desc', column)" [ngClass]="{'text-info': sortingRequest.sortBy === column && sortingRequest.sort === 'asc'}"></i>

  <i class="fas fa-long-arrow-alt-down" *ngIf="sortingRequest.sortBy === column && sortingRequest.sort === 'desc'" (click)="sortButtonClicked('asc', column)" [ngClass]="{'text-info': sortingRequest.sortBy === column && sortingRequest.sort === 'desc'}"></i>

</ng-template>
<!-- sorting -->

<app-timelog [timelogModalIsVisible]="timelogModalIsVisible" [selectedTaskItem]="selectedTaskItem" (toggleTimeLogShow)="timeLog(selectedTaskItem)"></app-timelog>
