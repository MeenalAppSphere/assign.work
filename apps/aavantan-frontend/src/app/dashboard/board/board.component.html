<div class="p-l-15">

  <section class="collaborators-avatar p-r-15">
    <div class="row board-header-section">

        <div class="col-md-6">

          <span class="p-l-10 sprint-name-button" >{{boardData && boardData.name ? boardData.name : 'Sprint'}}</span>

          <span *ngIf="boardData && boardData.membersCapacity?.length>0" class="p-l-30">

              <span *ngFor="let item of boardData.membersCapacity">
                <nz-avatar (click)="filterTask(item.user)" *ngIf="!item.user.profilePic"
                           nzText="{{(item.user && item.user.firstName ? item.user.firstName : item.user.emailId) | slice : 0:1}}"
                           ngClass="{{item.user.isSelected ? 'selected-user' : ''}}"
                           nzSize="" nzTitle="{{item.user.firstName}}" nzPlacement="top" nz-tooltip
                           class="bg-info"></nz-avatar>
                <nz-avatar (click)="filterTask(item.user)" *ngIf="item.user.profilePic" nzIcon="user" nzSize=""
                           ngClass="{{item.user.isSelected ? 'selected-user' : ''}}"
                           nzTitle="{{item.user && item.user.firstName ? item.user.firstName : item.user.emailId}}"
                           nzPlacement="top" nz-tooltip nzSrc="{{item.user.profilePic}}"></nz-avatar>
              </span>

          </span>


        </div>

        <div class="col-md-6 text-right user-filter-section">

            <span *ngIf="boardData?.endAt" class="sprint-date">
              <span class="font-size-12 text-gray-light-2 p-l-20 p-r-10">

                <span>
                  <span class="font-weight-bold" [ngClass]="boardData.sprintDaysLeft<0 ? 'text-red' : 'text-gray-light-2'">{{boardData.sprintDaysLeft}} days</span>&nbsp;<span class="text-gray-light-2 font-weight-light">remaining</span>
                </span>

                <img src="../../../assets/images/icons/info.svg" height="16" nzPlacement="top" class="m-l-10 cursor-pointer" nz-tooltip [nzTitle]="titleTemplate"/>

              </span>
            <ng-template #titleTemplate>
                <div><span class="d-inline-block w-45px">Goal</span>: {{boardData?.goal}}</div>
                <div><span class="d-inline-block w-45px">Starts</span>: {{boardData?.startedAt | date : 'MMM d yyyy'}}</div>
                <div><span class="d-inline-block w-45px">End</span>: {{boardData?.endAt | date : 'MMM d yyyy'}}</div>
            </ng-template>
            </span>


            <span class="header-btn-group">

              <button *ngIf="boardData" nzType="default" nzSize="small" nz-button class="btn-add-task m-r-5 m-l-25" (click)="toggleCloseSprintShow()">Close Sprint </button>

              <button nzType="primary" nzSize="small" nz-button class="btn-add-task " (click)="addTaskNavigate()">+ Add Task</button>

            </span>

        </div>

    </div>
</section>

  <nz-spin nzTip="Preparing board data..." [nzSpinning]="getStageInProcess">
    <div class="sprintboard-container">

        <div class="shadow-div-right"></div>

        <div class="container-fluid">
            <div class="row flex-row flex-nowrap" *ngIf="boardData && boardData.columns && boardData.columns.length>0">

                <div class="column dndList" joyrideStep="board" title="Board" text="Board" *ngFor="let item of boardData.columns; let last;let columnIndex = index">
                    <div class="card card-block">

                        <div class="card-header">{{item.name}} <span class="pull-right"><i class="pl-3 fa fa-ellipsis-v"></i></span>
                            <div class="pull-left" style="line-height: 10px;">
                                <small class="text-muted font-size-10">Total hours&nbsp;</small>&nbsp;
                                <span class="font-size-12">{{item.totalEstimationReadable}}</span>
                            </div>
                        </div>

                        <div class="card-body" dndDropzone (dndDrop)="onDragEnd($event, item)" dndEffectAllowed="copyMove" dndHorizontal="true">
                            <div dndPlaceholderRef class="dndPlaceholder">
                                Drop Here...
                            </div>

                            <div *ngFor="let task of item.tasks;let i = index" id="{{ i }}">
                                <div id="{{task.taskId}}" class="task-card" [ngStyle]="{'border-left': '4px solid '+ task.task.priority.color}" [dndDraggable]="task" (dndStart)="onDragStart(item)" [dndEffectAllowed]="'move'">
                                    <h6 [ngStyle]="{'color': task.task.taskType.color}">
                                        <span class="cursor-pointer" (click)="viewTask(task.task)">#{{task.task.displayName}}</span>
                                        <span class="float-right duration">
                                        <span nz-tooltip [nzTitle]="'Logged time'" class="text-black-dark font-weight-semibold">{{task.totalLoggedTimeReadable}}</span>
                                        <span nz-tooltip [nzTitle]="'Estimated time'" class="text-gray-light-2"> / {{task.task.estimatedTimeReadable}}</span>
                                        </span>
                                    </h6>
                                    <div class="task-body">
                                        <div>
                                            <a href="javascript:void(0)" (click)="viewTask(task.task)" class="task-title">{{task.task.name}} </a>
                                        </div>
                                    </div>
                                    <div class="task-footer">

                                      <div class="m-b-10"><nz-tag [nzColor]="'#F1F2F4'" class="text-black status-tag">{{task.task.status.name}}</nz-tag></div>

                                      <div>
                                        <span><nz-avatar class="m-r-5" nzIcon="user" nzSrc="{{task.task.assignee.profilePic}}"
                                     nzShape="circle"></nz-avatar><span class="profile-name">{{task.task.assignee.firstName}} {{task.task.assignee.lastName}}</span></span>
                                        <span class="pull-right">
                                          <a (click)="showTimeLogModal(columnIndex, i, task.task)" href="javascript:void(0);"
                                             class="text-primary">
                                          <i nz-icon nzType="clock-circle" theme="outline"></i>&ensp;&nbsp;Log Time</a>
                                        </span>
                                      </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div *ngIf="!boardData" class="text-center text-gray-light m-t-80">
                <nz-empty [nzNotFoundImage]="'../../../assets/images/not-found/no-board.svg'" [nzNotFoundContent]="contentTpl">
                    <ng-template #contentTpl>
                        <span></span>
                    </ng-template>

                </nz-empty>
            </div>
        </div>
    </div>

</nz-spin>

</div>

<nz-modal [(nzVisible)]="isVisibleCloseSprint" nzTitle="Close Sprint" nzOkText="Submit" nzMaskClosable="false" [nzWidth]="700" nzCancelText="Cancel" (nzOnOk)="closeSprint()" [nzOkLoading]="closeSprintInProcess" nzClassName="close-sprint-modal-confirm-box"
    (nzOnCancel)="cancelCloseSprintDialog()">

    <div>
        <nz-radio-group [(ngModel)]="closeSprintModeSelection" style="width: 100%;">
            <div class="row m-b-10">
                <div class="col-md-9">
                    <label nz-radio nzValue="createNewSprint">Create new sprint and move all open items into it</label>
                </div>
                <div class="col-md-3">

                </div>
            </div>

            <form *ngIf="closeSprintModeSelection === 'createNewSprint'" [formGroup]="closeSprintNewSprintForm" autocomplete="off" nz-form>
                <ng-container>
                    <section class="draft-sprint-box">

                        <div class="steps-content row">

                            <div class="col-md-7 col-sm-12">
                                <nz-form-item>
                                    <nz-form-label>Title<span class="text-danger">*</span></nz-form-label>
                                    <input nz-input formControlName="name" placeholder="Enter Sprint Title" nzSize="small" maxlength="50" />
                                </nz-form-item>
                            </div>

                            <div class="col-md-5 col-sm-12">
                                <nz-form-item>
                                    <nz-form-label>Duration (Start - End Date)<span class="text-danger">*</span></nz-form-label>
                                    <div class="sprint-duration-datepicker">
                                        <nz-range-picker formControlName="duration" [nzFormat]="dateFormat"></nz-range-picker>
                                    </div>
                                </nz-form-item>
                            </div>


                            <div class="col-md-12">
                                <nz-form-item class="m-0">
                                    <nz-form-label>Goal<span class="text-danger">*</span></nz-form-label>
                                    <textarea formControlName="goal" nz-input [rows]="3" placeholder="Enter Sprint Goal (max 250 character)" nzSize="small" maxlength="250"></textarea>
                                </nz-form-item>
                            </div>

                            <div class="col-md-12">
                                <nz-form-item class="m-0">
                                    <label nz-checkbox formControlName="createAndPublishNewSprint">Publish New Sprint ?</label>
                                </nz-form-item>
                            </div>

                        </div>

                    </section>
                </ng-container>

            </form>

            <hr class="m-t-15 m-b-0">

            <div class="row">
                <div class="col-md-9 col-sm-7 p-t-20">
                    <label nz-radio nzValue="moveToBacklog">Move all open items of this sprint to Backlog!</label>
                </div>
            </div>

        </nz-radio-group>

    </div>


</nz-modal>

<ng-container *ngIf="timelogModalIsVisible && selectedTask?.taskItem">
    <app-timelog [timelogModalIsVisible]="timelogModalIsVisible" [selectedTaskItem]="selectedTask.taskItem" (toggleTimeLogShow)="hideTimeLogModal($event)"></app-timelog>
</ng-container>

<app-close-sprint *ngIf="closeSprintModalIsVisible" [closeSprintModalIsVisible]="closeSprintModalIsVisible" [boardData]="boardData" [activeSprintData]="boardData" (toggleCloseSprintShow)="toggleCloseSprintShow()"></app-close-sprint>
